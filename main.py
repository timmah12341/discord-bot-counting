import discord
from discord.ext import commands
import random
import datetime
import asyncio
import os
import json

intents = discord.Intents.default()
intents.message_content = True
intents.messages = True
intents.guilds = True
intents.members = True

# Load or initialize database
def load_db():
    if not os.path.exists("db.json"):
            with open("db.json", "w") as f:
                        json.dump({
                                        "current_number": 1,
                                                        "leaderboard": {},
                                                                        "economy": {},
                                                                                        "banned_words": []
                                                                                                    }, f)
                                                                                                        with open("db.json", "r") as f:
                                                                                                                return json.load(f)

                                                                                                                def save_db(db):
                                                                                                                    with open("db.json", "w") as f:
                                                                                                                            json.dump(db, f)

                                                                                                                            db = load_db()

                                                                                                                            bot = commands.Bot(command_prefix="!", intents=intents, application_id=os.environ.get('APPLICATION_ID'))

                                                                                                                            @bot.event
                                                                                                                            async def on_ready():
                                                                                                                                print(f'Bot is online as: {bot.user.name}')
                                                                                                                                    try:
                                                                                                                                            synced = await bot.tree.sync()
                                                                                                                                                    print(f"Synced {len(synced)} command(s)")
                                                                                                                                                        except Exception as e:
                                                                                                                                                                print(f"Failed to sync commands: {e}")

                                                                                                                                                                async def handle_permission_error(interaction: discord.Interaction):
                                                                                                                                                                    await interaction.response.send_message("❌ You don't have permission to use this command!", ephemeral=True)

                                                                                                                                                                    # Economy functions
                                                                                                                                                                    def get_balance(user_id: str) -> int:
                                                                                                                                                                        return db["economy"].get(user_id, 0)

                                                                                                                                                                        def update_balance(user_id: str, amount: int):
                                                                                                                                                                            db["economy"][user_id] = get_balance(user_id) + amount
                                                                                                                                                                                save_db(db)

                                                                                                                                                                                # MODERATION COMMANDS
                                                                                                                                                                                @bot.tree.command(name="add_banned_word", description="Add a word to banned list")
                                                                                                                                                                                async def add_banned_word(interaction: discord.Interaction, word: str):
                                                                                                                                                                                    if interaction.user.guild_permissions.manage_messages:
                                                                                                                                                                                            db["banned_words"].append(word.lower())
                                                                                                                                                                                                    save_db(db)
                                                                                                                                                                                                            await interaction.response.send_message(f"Added '{word}' to banned words list")
                                                                                                                                                                                                                else:
                                                                                                                                                                                                                        await handle_permission_error(interaction)

                                                                                                                                                                                                                        @bot.tree.command(name="kick", description="Kick a member")
                                                                                                                                                                                                                        async def kick(interaction: discord.Interaction, member: discord.Member, reason: str = None):
                                                                                                                                                                                                                            if interaction.user.guild_permissions.kick_members:
                                                                                                                                                                                                                                    await member.kick(reason=reason)
                                                                                                                                                                                                                                            await interaction.response.send_message(f"Kicked {member.name} for: {reason}")
                                                                                                                                                                                                                                                else:
                                                                                                                                                                                                                                                        await handle_permission_error(interaction)

                                                                                                                                                                                                                                                        @bot.tree.command(name="ban", description="Ban a member")
                                                                                                                                                                                                                                                        async def ban(interaction: discord.Interaction, member: discord.Member, reason: str = None):
                                                                                                                                                                                                                                                            if interaction.user.guild_permissions.ban_members:
                                                                                                                                                                                                                                                                    await member.ban(reason=reason)
                                                                                                                                                                                                                                                                            await interaction.response.send_message(f"Banned {member.name} for: {reason}")
                                                                                                                                                                                                                                                                                else:
                                                                                                                                                                                                                                                                                        await handle_permission_error(interaction)

                                                                                                                                                                                                                                                                                        # GAME COMMANDS
                                                                                                                                                                                                                                                                                        @bot.tree.command(name="work", description="Work to earn coins")
                                                                                                                                                                                                                                                                                        async def work(interaction: discord.Interaction):
                                                                                                                                                                                                                                                                                            jobs = ["programmer", "chef", "doctor", "teacher", "artist"]
                                                                                                                                                                                                                                                                                                earnings = random.randint(10, 100)
                                                                                                                                                                                                                                                                                                    job = random.choice(jobs)
                                                                                                                                                                                                                                                                                                        update_balance(str(interaction.user.id), earnings)
                                                                                                                                                                                                                                                                                                            await interaction.response.send_message(f"You worked as a {job} and earned {earnings} coins!")

                                                                                                                                                                                                                                                                                                            @bot.tree.command(name="gamble", description="Gamble your coins")
                                                                                                                                                                                                                                                                                                            async def gamble(interaction: discord.Interaction, amount: int):
                                                                                                                                                                                                                                                                                                                balance = get_balance(str(interaction.user.id))
                                                                                                                                                                                                                                                                                                                    if amount > balance:
                                                                                                                                                                                                                                                                                                                            await interaction.response.send_message("You don't have enough coins!")
                                                                                                                                                                                                                                                                                                                                    return

                                                                                                                                                                                                                                                                                                                                        if random.random() > 0.5:
                                                                                                                                                                                                                                                                                                                                                update_balance(str(interaction.user.id), amount)
                                                                                                                                                                                                                                                                                                                                                        await interaction.response.send_message(f"You won {amount} coins!")
                                                                                                                                                                                                                                                                                                                                                            else:
                                                                                                                                                                                                                                                                                                                                                                    update_balance(str(interaction.user.id), -amount)
                                                                                                                                                                                                                                                                                                                                                                            await interaction.response.send_message(f"You lost {amount} coins!")

                                                                                                                                                                                                                                                                                                                                                                            @bot.tree.command(name="guess", description="Guess a number between 1-10")
                                                                                                                                                                                                                                                                                                                                                                            async def guess(interaction: discord.Interaction, number: int):
                                                                                                                                                                                                                                                                                                                                                                                correct = random.randint(1, 10)
                                                                                                                                                                                                                                                                                                                                                                                    if number == correct:
                                                                                                                                                                                                                                                                                                                                                                                            update_balance(str(interaction.user.id), 50)
                                                                                                                                                                                                                                                                                                                                                                                                    await interaction.response.send_message("Correct! You won 50 coins!")
                                                                                                                                                                                                                                                                                                                                                                                                        else:
                                                                                                                                                                                                                                                                                                                                                                                                                await interaction.response.send_message(f"Wrong! The number was {correct}")

                                                                                                                                                                                                                                                                                                                                                                                                                @bot.tree.command(name="current", description="Check the current number in the counting game")
                                                                                                                                                                                                                                                                                                                                                                                                                async def current(interaction: discord.Interaction):
                                                                                                                                                                                                                                                                                                                                                                                                                    await interaction.response.send_message(f"The current number is: {db['current_number']}")

                                                                                                                                                                                                                                                                                                                                                                                                                    @bot.tree.command(name="balance", description="Check your balance and stats")
                                                                                                                                                                                                                                                                                                                                                                                                                    async def balance(interaction: discord.Interaction):
                                                                                                                                                                                                                                                                                                                                                                                                                        user_id = str(interaction.user.id)
                                                                                                                                                                                                                                                                                                                                                                                                                            bal = get_balance(user_id)
                                                                                                                                                                                                                                                                                                                                                                                                                                score = db["leaderboard"].get(user_id, 0)
                                                                                                                                                                                                                                                                                                                                                                                                                                    embed = discord.Embed(title="👤 User Profile", color=discord.Color.gold())
                                                                                                                                                                                                                                                                                                                                                                                                                                        embed.add_field(name="💰 Balance", value=f"{bal} coins", inline=False)
                                                                                                                                                                                                                                                                                                                                                                                                                                            embed.add_field(name="🏆 Score", value=f"{score} points", inline=False)
                                                                                                                                                                                                                                                                                                                                                                                                                                                await interaction.response.send_message(embed=embed)

                                                                                                                                                                                                                                                                                                                                                                                                                                                # MESSAGE HANDLER
                                                                                                                                                                                                                                                                                                                                                                                                                                                @bot.event
                                                                                                                                                                                                                                                                                                                                                                                                                                                async def on_message(message):
                                                                                                                                                                                                                                                                                                                                                                                                                                                    if message.author == bot.user:
                                                                                                                                                                                                                                                                                                                                                                                                                                                            return

                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Banned words
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if any(word in message.content.lower() for word in db["banned_words"]):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await message.delete()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await message.channel.send(f"{message.author.mention} That word is not allowed!")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Number game
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if message.content.isdigit():
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        number = int(message.content)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    current = db["current_number"]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if number == current:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if number % 2 == 1:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    uid = str(message.author.id)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        db["leaderboard"][uid] = db["leaderboard"].get(uid, 0) + 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            db["current_number"] += 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await message.add_reaction("✅")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await message.channel.send(str(db["current_number"]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    else:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await message.add_reaction("❌")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            db["current_number"] = 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await message.channel.send("You need to send an odd number!\nGame restarted. Current number: 1")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                save_db(db)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    except Exception as e:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            print(f"Error in number game: {e}")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await bot.process_commands(message)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                bot.run(os.environ["DISCORD_TOKEN"])import discord
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                from discord.ext import commands
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import random
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import datetime
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import asyncio
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import os
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                import json

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                intents = discord.Intents.default()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                intents.message_content = True
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                intents.messages = True
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                intents.guilds = True
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                intents.members = True

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Load or initialize database
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                def load_db():
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if not os.path.exists("db.json"):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            with open("db.json", "w") as f:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        json.dump({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "current_number": 1,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "leaderboard": {},
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "economy": {},
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "banned_words": []
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }, f)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        with open("db.json", "r") as f:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return json.load(f)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                def save_db(db):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    with open("db.json", "w") as f:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            json.dump(db, f)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            db = load_db()

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            bot = commands.Bot(command_prefix="!", intents=intents, application_id=os.environ.get('APPLICATION_ID'))

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            @bot.event
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            async def on_ready():
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                print(f'Bot is online as: {bot.user.name}')
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            synced = await bot.tree.sync()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    print(f"Synced {len(synced)} command(s)")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        except Exception as e:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                print(f"Failed to sync commands: {e}")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                async def handle_permission_error(interaction: discord.Interaction):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await interaction.response.send_message("❌ You don't have permission to use this command!", ephemeral=True)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    # Economy functions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    def get_balance(user_id: str) -> int:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return db["economy"].get(user_id, 0)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        def update_balance(user_id: str, amount: int):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            db["economy"][user_id] = get_balance(user_id) + amount
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                save_db(db)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # MODERATION COMMANDS
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @bot.tree.command(name="add_banned_word", description="Add a word to banned list")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                async def add_banned_word(interaction: discord.Interaction, word: str):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if interaction.user.guild_permissions.manage_messages:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            db["banned_words"].append(word.lower())
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    save_db(db)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await interaction.response.send_message(f"Added '{word}' to banned words list")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await handle_permission_error(interaction)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @bot.tree.command(name="kick", description="Kick a member")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        async def kick(interaction: discord.Interaction, member: discord.Member, reason: str = None):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if interaction.user.guild_permissions.kick_members:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await member.kick(reason=reason)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await interaction.response.send_message(f"Kicked {member.name} for: {reason}")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await handle_permission_error(interaction)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @bot.tree.command(name="ban", description="Ban a member")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        async def ban(interaction: discord.Interaction, member: discord.Member, reason: str = None):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if interaction.user.guild_permissions.ban_members:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await member.ban(reason=reason)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await interaction.response.send_message(f"Banned {member.name} for: {reason}")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await handle_permission_error(interaction)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        # GAME COMMANDS
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        @bot.tree.command(name="work", description="Work to earn coins")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        async def work(interaction: discord.Interaction):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            jobs = ["programmer", "chef", "doctor", "teacher", "artist"]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                earnings = random.randint(10, 100)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    job = random.choice(jobs)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        update_balance(str(interaction.user.id), earnings)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await interaction.response.send_message(f"You worked as a {job} and earned {earnings} coins!")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            @bot.tree.command(name="gamble", description="Gamble your coins")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            async def gamble(interaction: discord.Interaction, amount: int):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                balance = get_balance(str(interaction.user.id))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if amount > balance:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await interaction.response.send_message("You don't have enough coins!")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if random.random() > 0.5:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                update_balance(str(interaction.user.id), amount)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await interaction.response.send_message(f"You won {amount} coins!")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            else:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    update_balance(str(interaction.user.id), -amount)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await interaction.response.send_message(f"You lost {amount} coins!")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            @bot.tree.command(name="guess", description="Guess a number between 1-10")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            async def guess(interaction: discord.Interaction, number: int):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                correct = random.randint(1, 10)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if number == correct:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            update_balance(str(interaction.user.id), 50)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await interaction.response.send_message("Correct! You won 50 coins!")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        else:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await interaction.response.send_message(f"Wrong! The number was {correct}")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @bot.tree.command(name="current", description="Check the current number in the counting game")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                async def current(interaction: discord.Interaction):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await interaction.response.send_message(f"The current number is: {db['current_number']}")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    @bot.tree.command(name="balance", description="Check your balance and stats")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    async def balance(interaction: discord.Interaction):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        user_id = str(interaction.user.id)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            bal = get_balance(user_id)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                score = db["leaderboard"].get(user_id, 0)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    embed = discord.Embed(title="👤 User Profile", color=discord.Color.gold())
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        embed.add_field(name="💰 Balance", value=f"{bal} coins", inline=False)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            embed.add_field(name="🏆 Score", value=f"{score} points", inline=False)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await interaction.response.send_message(embed=embed)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # MESSAGE HANDLER
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                @bot.event
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                async def on_message(message):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if message.author == bot.user:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Banned words
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if any(word in message.content.lower() for word in db["banned_words"]):
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            await message.delete()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await message.channel.send(f"{message.author.mention} That word is not allowed!")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                # Number game
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if message.content.isdigit():
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        number = int(message.content)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    current = db["current_number"]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if number == current:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if number % 2 == 1:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    uid = str(message.author.id)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        db["leaderboard"][uid] = db["leaderboard"].get(uid, 0) + 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            db["current_number"] += 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await message.add_reaction("✅")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await message.channel.send(str(db["current_number"]))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    else:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await message.add_reaction("❌")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            db["current_number"] = 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await message.channel.send("You need to send an odd number!\nGame restarted. Current number: 1")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                save_db(db)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    except Exception as e:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            print(f"Error in number game: {e}")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                await bot.process_commands(message)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                bot.run(os.environ["DISCORD_TOKEN"])